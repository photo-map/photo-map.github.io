(this["webpackJsonpphoto-map.github.io"]=this["webpackJsonpphoto-map.github.io"]||[]).push([[0],{279:function(e,n,t){},303:function(e,n,t){},304:function(e,n,t){},524:function(e,n,t){},525:function(e,n,t){"use strict";t.r(n);var r=t(0),a=t.n(r),o=t(12),i=t.n(o),s=(t(279),t(15)),c=t(16),l=t(23),u=t(22),d=t(9),p=t.n(d),f=t(82),b=t(11),h=t.n(b),m=t(26),g=t(270),j=t(529),v=t(530),k=t(115),w=t(37),M=t.n(w),O=t(528),x=t(531),S=t(1);function y(e){return Object(S.jsx)(O.a,{content:e.children,title:null,children:Object(S.jsx)(x.a,{})})}var C=t(260),I="pmap::selectedMap",F="googlemap.fitmarkers",A=function(e,n){var t=[];return e.getAllOverlays("marker").forEach((function(e){e.getExtData().folderId===n&&t.push(e)})),t},L="amap.showmarkers",P="amap.hidemarkers",G="amap.removemarkersinfolder",T=(t(303),M()("photo-map:src/Application/Map/AMap/index.jsx")),R="amap.addmarkers",D="amap.removeallmarkers",E=function(e){Object(l.a)(t,e);var n=Object(u.a)(t);function t(){var e;Object(s.a)(this,t);for(var r=arguments.length,a=new Array(r),o=0;o<r;o++)a[o]=arguments[o];return(e=n.call.apply(n,[this].concat(a))).map=null,e.allMarkers=[],e.addSubscribers=function(){e.addMarkersToken=p.a.subscribe(R,e.addMarkersSubscriber),e.removeAllMarkersToken=p.a.subscribe(D,e.removeAllMarkersSubscriber),e.removeMarkersInFolderToken=p.a.subscribe(G,e.removeMarkersInFolderSubscriber),e.showMarkersToken=p.a.subscribe(L,e.showMarkersSubscriber),e.hideMarkersToken=p.a.subscribe(P,e.hideMarkersSubscriber),e.fitMarkersToken=p.a.subscribe(F,e.fitMarkersSubscriber)},e.removeSubscribers=function(){p.a.unsubscribe(e.addMarkersToken),p.a.unsubscribe(e.removeAllMarkersToken),p.a.unsubscribe(e.removeMarkersInFolderToken),p.a.unsubscribe(e.showMarkersToken),p.a.unsubscribe(e.hideMarkersToken)},e.addMarkersSubscriber=function(n,t){e.addMarkers(t.files,t.visible,t.folderId)},e.removeMarkersInFolderSubscriber=function(n,t){e.removeMarkersInFolder(t.folderId)},e.removeAllMarkersSubscriber=function(n){e.removeAllMarkers()},e.showMarkersSubscriber=function(n,t){e.updateMarkersInFolderVisible(t.folderId,!0)},e.hideMarkersSubscriber=function(n,t){e.updateMarkersInFolderVisible(t.folderId,!1)},e.fitMarkersSubscriber=function(n){e.map?e.map.setFitView():console.error("this.map of AMap is undefined!")},e.updateMarkersInFolderVisible=function(n,t){A(e.map,n).forEach((function(e){t?e.show():e.hide()})),e.map.setFitView()},e.genMarker=function(n,t,r){return new window.AMap.Marker({map:e.map,visible:r,position:n.lnglat,icon:new window.AMap.Icon({size:new window.AMap.Size(64,64),image:n.thumbnail,imageSize:new window.AMap.Size(64,64)}),extData:{folderId:t}})},e.addMarkers=function(n){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],r=arguments.length>2?arguments[2]:void 0;if(window.AMap){var a=[];n.forEach((function(e){a.push([e.imageMediaMetadata.location.longitude,e.imageMediaMetadata.location.latitude])})),T("window.AMap.convertFrom() loading"),window.AMap.convertFrom(a,"gps",(function(a,o){(T("window.AMap.convertFrom",a,o),"ok"===o.info)&&(o.locations.map((function(e,t){return{lnglat:e,thumbnail:n[t].thumbnailLink,webViewLink:n[t].webViewLink}})).forEach((function(n){var a=e.genMarker(n,r,t);a.content='<div><a target="_blank" href="'.concat(n.webViewLink,'"><img src="').concat(n.thumbnail,'"></a></div>'),e.allMarkers.push(a);a.on("click",(function(n){var t=new window.AMap.InfoWindow({offset:new window.AMap.Pixel(0,-30)});t.setContent(n.target.content),t.open(e.map,n.target.getPosition())}))})),e.map.setFitView())}))}else alert("We are about to convert location from GPS to AMap, but AMap still not loaded!")},e.removeMarkersInFolder=function(n){var t=[];e.map.getAllOverlays("marker").forEach((function(e){e.getExtData().folderId===n&&t.push(e)})),e.map.remove(t)},e.removeAllMarkers=function(){e.map.remove(e.allMarkers)},e}return Object(c.a)(t,[{key:"componentDidMount",value:function(){this.addSubscribers()}},{key:"componentWillUnmount",value:function(){this.removeSubscribers()}},{key:"render",value:function(){var e=this,n=this.props,t=n.defaultCenter,r=n.defaultZoom,a={created:function(n){e.props.onMapInstanceCreated(n),e.map=n},click:function(e){T("AMap event: click",e);var n=e.lnglat;console.log("You click on the AMap, lngLat: ".concat(n.toString()))}},o=[];return window.AMap&&o.push(new window.AMap.TileLayer.Satellite),Object(S.jsx)("div",{className:"amap-wrapper",children:Object(S.jsx)(C.Map,{amapkey:"2af81967e36bb62f50534e7b5c530ff9",version:"1.4.15",center:t,zoom:r,layers:o,events:a})})}}]),t}(r.Component);function V(e){return new Promise((function(n,t){window.gapi.client.request(e).execute((function(e){n(e)}))}))}var B=function(){var e=Object(m.a)(h.a.mark((function e(n){return h.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,V({path:"https://www.googleapis.com/drive/v3/files/".concat(n.fileId)});case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e)})));return function(n){return e.apply(this,arguments)}}(),N=function(){var e=Object(m.a)(h.a.mark((function e(n){return h.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,V({path:"https://www.googleapis.com/drive/v3/files",params:n});case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e)})));return function(n){return e.apply(this,arguments)}}(),U=["files/imageMediaMetadata/location","files/thumbnailLink","files/webContentLink","files/webViewLink"].join(","),W=function(){var e=Object(m.a)(h.a.mark((function e(n){return h.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,B({fileId:n});case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e)})));return function(n){return e.apply(this,arguments)}}(),Z=function(){var e=Object(m.a)(h.a.mark((function e(n){return h.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,N({q:"'".concat(n,"' in parents and (mimeType='image/jpeg' or mimeType='image/png')"),fields:U});case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e)})));return function(n){return e.apply(this,arguments)}}(),z=function(){var e=Object(m.a)(h.a.mark((function e(){return h.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,N({q:"name='Photo Map' and mimeType='application/vnd.google-apps.folder'"});case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),_=function(){var e=Object(m.a)(h.a.mark((function e(n){var t,r,a;return h.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,z();case 2:if((t=e.sent).files){e.next=5;break}return e.abrupt("return",[]);case 5:return r=t.files[0].id,e.next=8,Z(r);case 8:return a=e.sent,e.abrupt("return",a.files);case 10:case"end":return e.stop()}}),e)})));return function(n){return e.apply(this,arguments)}}(),q=t(49),J=t(102),H=t(533),Y=t(534),K="google",Q="amap",$="baidu",X="__privateFolderId__",ee=M()("photo-map:src/Application/MenuDrawer/FolderList.jsx"),ne="publicfolder.add",te="pmap:publicFolders",re="pmap:privateFolderVisible",ae=function(e){var n={};return e.forEach((function(e){n[e.folderId]=e.visible})),JSON.stringify(n)},oe=function(){return JSON.parse(localStorage.getItem(te))},ie=function(e){Object(l.a)(t,e);var n=Object(u.a)(t);function t(){var e;Object(s.a)(this,t);for(var r=arguments.length,a=new Array(r),o=0;o<r;o++)a[o]=arguments[o];return(e=n.call.apply(n,[this].concat(a))).state={privateFolderVisible:!0,publicFolders:[]},e.handlePrivateFolderCheckboxChange=function(n){var t=n.target.checked;e.updatePrivateFolderVisible(t),p.a.publish(t?L:P,{folderId:X})},e.addSubscribers=function(){e.openDrawerToken=p.a.subscribe(ne,e.addPublicFolderSubscriber)},e.removeSubscribers=function(){p.a.unsubscribe(e.openDrawerToken)},e.addPublicFolderSubscriber=function(n,t){e.addPublicFolder(t)},e.updatePrivateFolderVisible=function(n){e.setState({privateFolderVisible:n}),localStorage.setItem(re,n)},e.addPublicFolder=function(n){var t=e.state.publicFolders,r=[].concat(Object(J.a)(t),[n]);e.setState({publicFolders:r}),localStorage.setItem(te,ae(r))},e.updatePublicFolderVisiable=function(n,t){var r=e.state.publicFolders,a=Object(J.a)(r);a.forEach((function(e,r){e.folderId===n&&(a[r]=Object(q.a)(Object(q.a)({},e),{},{visible:t}))})),e.setState({publicFolders:a}),localStorage.setItem(te,ae(a))},e.updateMarkersVisible=function(e,n){p.a.publish(e?L:P,{folderId:n})},e.removePublicFolder=function(n){e.setState((function(e){var t=e.publicFolders.filter((function(e){return e.folderId!==n}));return localStorage.setItem(te,ae(t)),{publicFolders:t}}))},e.removeMarkersInFolder=function(e){p.a.publish(G,{folderId:e})},e.getPhotoCountInFolder=function(n){var t="Unknown count",r=e.props.folders.find((function(e){return e.folderId===n}));return r&&(t=r.files.length+""),t},e.renderPublicFolders=function(){var n=e.state.publicFolders;return 0===n.length?"No data":n.map(e.renderPublicFolder)},e.renderPublicFolder=function(n){var t=n.folderId;return Object(S.jsx)("div",{children:Object(S.jsxs)(H.a,{checked:n.visible,onChange:function(n){e.updatePublicFolderVisiable(t,n.target.checked),e.updateMarkersVisible(n.target.checked,t)},children:[n.folderName," (",e.getPhotoCountInFolder(t),") :"," ",n.folderId," ",Object(S.jsx)(Y.a,{title:"Are you sure delete this folder?",onConfirm:function(){e.removePublicFolder(t),e.removeMarkersInFolder(t)},onCancel:function(){},okText:"Yes",cancelText:"No",children:Object(S.jsx)(k.a,{size:"small",type:"danger",children:"Del"})})]})},n.folderId)},e}return Object(c.a)(t,[{key:"componentDidMount",value:function(){this.addSubscribers(),this.setState({privateFolderVisible:"true"===localStorage.getItem(re)})}},{key:"componentWillUnmount",value:function(){this.removeSubscribers()}},{key:"render",value:function(){return ee("render()",this.props,this.state),Object(S.jsxs)("div",{children:[Object(S.jsxs)("div",{children:[Object(S.jsx)("h3",{children:"Private folder in Google Drive"}),Object(S.jsxs)(H.a,{checked:this.state.privateFolderVisible,onChange:this.handlePrivateFolderCheckboxChange,children:['"Photo Map" folder in Google Drive of the login user (',this.getPhotoCountInFolder(X),")"]})]}),Object(S.jsxs)("div",{children:[Object(S.jsx)("h3",{children:"Public folder in Google Drive"}),this.renderPublicFolders()]})]})}}]),t}(r.Component),se=function(e){var n=[];return e.forEach((function(e){e.files.forEach((function(e){n.push({lat:e.imageMediaMetadata.location.latitude,lng:e.imageMediaMetadata.location.longitude})}))})),n},ce=function(e){return new Promise((function(n,t){(new window.BMapGL.Convertor).translate(e,1,5,(function(e){if(console.log("translateCallback",e),25===e.status){console.log("more than limitation of this API");var r=t(new Error("more than limitation of this API"));return console.log("translateCallback reject",r),r}if(0!==e.status)return t("unknown error, please check https://lbsyun.baidu.com/index.php?title=webapi/guide/changeposition for more details, response.status: "+e.status);n(e)}))}))},le=function(e,n){var t,r,a=[];for(t=0,r=e.length;t<r;t+=n)a.push(e.slice(t,t+n));return a},ue=function(){var e=Object(m.a)(h.a.mark((function e(n){var t,r;return h.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,W(n);case 2:return t=e.sent,e.next=5,Z(n);case 5:if(!(r=e.sent).error){e.next=9;break}throw console.error("Failed to get photos in a public folders, response:",r),new Error(r.error.message);case 9:return e.abrupt("return",{files:r.files,visible:!0,folderId:n,folderName:t.name});case 10:case"end":return e.stop()}}),e)})));return function(n){return e.apply(this,arguments)}}(),de=function(){var e=Object(m.a)(h.a.mark((function e(){var n;return h.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=JSON.parse(localStorage.getItem(te))){e.next=3;break}return e.abrupt("return",[]);case 3:return e.next=5,Promise.all(Object.keys(n).map(function(){var e=Object(m.a)(h.a.mark((function e(n){return h.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,ue(n);case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e)})));return function(n){return e.apply(this,arguments)}}()));case 5:return e.abrupt("return",e.sent);case 6:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),pe=function(){var e=Object(m.a)(h.a.mark((function e(n){var t;return h.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t={files:n,visible:"true"===localStorage.getItem(re),folderId:X},p.a.publish(R,t),e.next=4,de();case 4:e.sent.forEach((function(e){return p.a.publish(R,e)}));case 6:case"end":return e.stop()}}),e)})));return function(n){return e.apply(this,arguments)}}(),fe=function(){var e=Object(m.a)(h.a.mark((function e(n){var t,r,a,o;return h.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=se(n),r=le(t,10),e.next=4,Promise.all(r.map(function(){var e=Object(m.a)(h.a.mark((function e(n){var t;return h.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,ce(n);case 2:return t=e.sent,e.abrupt("return",{gpsPoints:n,bMapPoints:t.points});case 4:case"end":return e.stop()}}),e)})));return function(n){return e.apply(this,arguments)}}()));case 4:return a=e.sent,o={},a.forEach((function(e){e.gpsPoints.forEach((function(n,t){var r=e.bMapPoints[t];o["".concat(n.lat,",").concat(n.lng)]=r}))})),e.abrupt("return",o);case 8:case"end":return e.stop()}}),e)})));return function(n){return e.apply(this,arguments)}}(),be=t(532),he=t(190),me=t.n(he),ge=M()("photo-map:src/Application/MapSelector.jsx"),je={display:"block",height:"30px",lineHeight:"30px"};function ve(e){ge("render()");var n=e.selectedMap;return Object(S.jsxs)("div",{className:"map-selector",children:[Object(S.jsx)("h3",{children:"Choose Map:"}),Object(S.jsxs)(be.a.Group,{onChange:function(n){e.onChange&&e.onChange(n.target.value)},value:n,children:[Object(S.jsxs)(be.a,{style:je,value:Q,children:["AMap (",me()(window,"AMap.v"),")"]}),Object(S.jsxs)(be.a,{style:je,value:$,children:["Baidu Map (",me()(window,"BMapGL.version"),")"]}),Object(S.jsx)(be.a,{style:je,value:K,children:"Google Maps"})]})]})}var ke=function(e){Object(l.a)(t,e);var n=Object(u.a)(t);function t(){return Object(s.a)(this,t),n.apply(this,arguments)}return Object(c.a)(t,[{key:"render",value:function(){return Object(S.jsxs)("span",{children:["Photo Map"," ",Object(S.jsx)(y,{children:Object(S.jsxs)("div",{children:["Please read the"," ",Object(S.jsx)(f.a.OutboundLink,{eventLabel:"HowToUse",to:"https://github.com/photo-map/photo-map.github.io/blob/master/help/HOW_TO_USE.md#how-to-use",target:"_blank",children:"How to use"})," ","document in GitHub repo."]})})]})}}]),t}(r.Component);var we=["profile","email","https://www.googleapis.com/auth/drive"].join(" "),Me=function(){var e=window.gapi.auth2.getAuthInstance();return e&&e.isSignedIn.get()?null:Object(S.jsx)("div",{id:"custom-google-login-button"})},Oe=function(e){Object(l.a)(t,e);var n=Object(u.a)(t);function t(e){var r;return Object(s.a)(this,t),(r=n.call(this,e)).handleSignOutBtnClick=function(){var e=r.props.onSignedOut;window.gapi.auth2.getAuthInstance().signOut().then((function(){console.debug("[GoogleLogin] User signed out by clicking button."),r.setState({signedIn:!1}),e()}))},r.renderSignOutBtn=function(){return r.state.signedIn?Object(S.jsx)("button",{type:"button",onClick:r.handleSignOutBtnClick,children:"Sign out"}):null},r.state={gapiAuth2Loaded:!1,signedIn:!1},r}return Object(c.a)(t,[{key:"componentDidMount",value:function(){var e=this,n=this.props,t=n.onLoginSuccess,r=n.onRenderFinish;this.mounted=!0;window.gapi.load("auth2",(function(){console.debug("[GoogleLogin] auth2 loaded");var n=e.props.clientId;if(e.mounted){e.setState({gapiAuth2Loaded:!0});var a=window.gapi.auth2.init({client_id:n,scope:we});!function(e,n){console.debug("renderGoogleLoginBtn()",e,n),n.attachClickHandler("custom-google-login-button",{},(function(n){console.debug("onSuccess()",n),console.debug("User signed in by clicking button."),e.onLoginSuccess(n)}),(function(e){console.debug("onFailure(), error:",e)})),n.isSignedIn.listen((function(e){console.debug("signinChanged()",e)})),n.currentUser.listen((function(e){console.debug("userChanged()",e)})),window.gapi.load("signin2",(function(){console.debug("signin2 loaded"),window.gapi.signin2.render("custom-google-login-button",{onsuccess:function(n){console.debug("handleSuccess()",n),console.debug("User already signed in when rendering button."),e.onLoginSuccess(n)},onfailure:function(e,n,t){console.debug("handleFailure",e,n,t)}}),e.onRenderFinish()}))}({onLoginSuccess:function(n){e.mounted||console.warn("GoogleLogin is umounted when onLoginSuccess()!"),e.setState({signedIn:!0}),t(n)},onRenderFinish:r},a)}else console.warn("GoogleLogin is umounted when onGapiAuth2Loaded()!")}))}},{key:"componentWillUnmount",value:function(){this.mounted=!1}},{key:"render",value:function(){return this.state.gapiAuth2Loaded?Object(S.jsxs)("div",{children:[Object(S.jsx)("h3",{children:"Google Login"}),Me(),this.renderSignOutBtn()]}):Object(S.jsx)("div",{children:'The "auth2" gapi library doesn\'t loaded yet.'})}}]),t}(r.Component),xe=t(100),Se=function(e){return e.replace("https://drive.google.com/drive/folders/","").replace("?usp=sharing","")},ye=function(e){var n,t=(n={},Object(xe.a)(n,re,e.getItem(re)),Object(xe.a)(n,te,e.getItem(te)),Object(xe.a)(n,I,e.getItem(I)),n);return"data:text/json;charset=utf-8,"+encodeURIComponent(JSON.stringify(t,null,2))},Ce=function(e,n){e.setItem(re,n["pmap:privateFolderVisible"]),e.setItem(te,n["pmap:publicFolders"]),e.setItem(I,n["pmap::selectedMap"])},Ie=function(e){Object(l.a)(t,e);var n=Object(u.a)(t);function t(e){var r;return Object(s.a)(this,t),(r=n.call(this,e)).handleDownload=function(){r.setState({href:ye(localStorage)},(function(){r.downloadRef&&r.downloadRef.current?r.downloadRef.current.click():alert("downloadRef or node is undefined!")}))},r.handleImport=function(){r.inputRef&&r.inputRef.current?r.inputRef.current.click():alert("inputRef or node is undefined!")},r.handleChange=function(){var e=Object(m.a)(h.a.mark((function e(n){var t,r,a;return h.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!(t=n.target.files[0])){e.next=7;break}return e.next=4,new Response(t).text();case 4:r=e.sent,a=JSON.parse(r),Ce(localStorage,a);case 7:case"end":return e.stop()}}),e)})));return function(n){return e.apply(this,arguments)}}(),r.downloadRef=a.a.createRef(),r.inputRef=a.a.createRef(),r.state={href:"{}"},r}return Object(c.a)(t,[{key:"render",value:function(){return Object(S.jsxs)("div",{children:[Object(S.jsx)("h3",{children:"Import/Export application config"}),Object(S.jsx)("a",{ref:this.downloadRef,href:this.state.href,style:{display:"none"},download:"photo-map-config.json",children:"Download Config File"}),Object(S.jsx)(k.a,{onClick:this.handleDownload,children:"Export"}),Object(S.jsx)("input",{ref:this.inputRef,className:"import-config-file-helper",type:"file",style:{display:"none"},onChange:this.handleChange}),Object(S.jsx)(k.a,{onClick:this.handleImport,children:"Import"})]})}}]),t}(r.Component),Fe=M()("photo-map:src/Application/MenuDrawer/index.jsx"),Ae="menudrawer.open",Le="menudrawer.openclose",Pe=function(e){Object(l.a)(t,e);var n=Object(u.a)(t);function t(){var e;Object(s.a)(this,t);for(var r=arguments.length,a=new Array(r),o=0;o<r;o++)a[o]=arguments[o];return(e=n.call.apply(n,[this].concat(a))).state={drawerVisible:!1,publicFolderLink:"",loading:!1},e.handleDrawerClose=function(){e.setVisible(!1)},e.handlePublicFolderLinkChange=function(n){e.setState({publicFolderLink:n.target.value})},e.handlePublicFolderInputPressEnter=function(){e.loadPublicFolderAndAddMarkers()},e.handleLoadPublicFolderBtnClick=function(){e.loadPublicFolderAndAddMarkers()},e.loadPublicFolderAndAddMarkers=Object(m.a)(h.a.mark((function n(){var t,r;return h.a.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(!e.state.loading){n.next=3;break}return g.b.warn("Previous public folder is loading now, please wait a moment."),n.abrupt("return");case 3:if(t=Se(e.state.publicFolderLink),void 0===oe()[t]){n.next=7;break}return g.b.warn("There is an existing public folder!"),n.abrupt("return");case 7:return r=null,n.prev=8,e.setState({loading:!0}),n.next=12,ue(t);case 12:r=n.sent,e.setState({loading:!1}),n.next=22;break;case 16:return n.prev=16,n.t0=n.catch(8),console.error("failed to get photos in a public folder, error:",n.t0),g.b.error(n.t0.message),e.setState({loading:!1}),n.abrupt("return");case 22:p.a.publish(ne,r),p.a.publish(R,r);case 24:case"end":return n.stop()}}),n,null,[[8,16]])}))),e.setVisible=function(n){e.setState({drawerVisible:n})},e.openDrawerSubscriber=function(n){e.setVisible(!0)},e.openCloseDrawerSubscriber=function(n){e.setVisible(!e.state.drawerVisible)},e.addSubscribers=function(){e.openDrawerToken=p.a.subscribe(Ae,e.openDrawerSubscriber),e.openCloseDrawerToken=p.a.subscribe(Le,e.openCloseDrawerSubscriber)},e.removeSubscribers=function(){p.a.unsubscribe(e.openDrawerToken)},e}return Object(c.a)(t,[{key:"componentDidMount",value:function(){this.addSubscribers()}},{key:"componentWillUnmount",value:function(){this.removeSubscribers()}},{key:"render",value:function(){Fe("render()");var e=this.props.selectedMap,n=this.state,t=n.drawerVisible,r=n.publicFolderLink;return Object(S.jsx)("div",{className:"menu-drawer",children:Object(S.jsxs)(j.a,{className:"menu-drawer",width:"50%",title:Object(S.jsx)(ke,{}),placement:"left",closable:!1,forceRender:!0,visible:t,onClose:this.handleDrawerClose,children:[Object(S.jsx)(ve,{selectedMap:e,onChange:this.props.onMapChange}),Object(S.jsx)(Oe,{clientId:"769870583187-6p6tvl5nh7qc8m9hrgqh285siqm9oc37.apps.googleusercontent.com",onLoginSuccess:this.props.onLoginSuccess,onRenderFinish:this.props.onRenderFinish,onSignedOut:this.props.onSignedOut}),Object(S.jsxs)("div",{children:[Object(S.jsxs)("div",{children:["Public folder link:"," ",Object(S.jsx)(y,{children:Object(S.jsxs)("div",{children:[Object(S.jsx)("div",{children:"Please fill the public folder link. For example:"}),Object(S.jsx)("div",{children:"https://drive.google.com/drive/folders/13s5wep_gYYVCroQcFB6nJHMWz8V2Onsr?usp=sharing"})]})})]}),Object(S.jsx)(v.a,{value:r,onChange:this.handlePublicFolderLinkChange,onPressEnter:this.handlePublicFolderInputPressEnter}),Object(S.jsx)(k.a,{disabled:this.state.loading,onClick:this.handleLoadPublicFolderBtnClick,children:"Load"}),Object(S.jsx)("hr",{}),Object(S.jsx)(ie,{folders:this.props.folders}),Object(S.jsx)("hr",{}),Object(S.jsx)(Ie,{})]})]})})}}]),t}(r.Component);t(304);function Ge(e){var n=e.message;return n?Object(S.jsx)("div",{className:"message-wrapper",children:Object(S.jsx)("div",{className:"message-body",children:Object(S.jsx)("span",{className:"message-content",children:n})})}):null}var Te=t(50);function Re(e){var n=e.latLng;console.log("You click on the Google Maps, latLng: ".concat(n.toString()))}var De=function(e){return Object(S.jsx)(Te.GoogleMap,{defaultZoom:e.defaultZoom,defaultCenter:e.defaultCenter,defaultOptions:{mapTypeControlOptions:{position:window.google.maps.ControlPosition.TOP_RIGHT}},mapTypeId:"satellite",ref:e.refCallback,onClick:Re,children:e.children})},Ee=t(160),Ve=M()("photo-map:src/Application/Map/GoogleMap/GoogleMapCompose.jsx"),Be=Object(Ee.a)(Object(Ee.c)((function(e){return{googleMapURL:"https://maps.googleapis.com/maps/api/js?key=".concat("AIzaSyBI9zDejJ09aIP8kw3GvTOBbYWwcOl0DUY","&v=3.exp&libraries=geometry,drawing,places"),loadingElement:Object(S.jsx)("div",{style:{height:"100%"}}),containerElement:Object(S.jsx)("div",{style:{height:"100vh"}}),mapElement:Object(S.jsx)("div",{style:{height:"100%"}})}})),Object(Ee.b)((function(e){var n={map:void 0};return{refCallback:function(){return function(t){Ve("refCallback()()",t),n.map=t,null!==t?e.onMapMounted(t):e.onMapUnmounted()}}}})),Te.withScriptjs,Te.withGoogleMap),Ne=t(273),Ue=function(e){return Object(S.jsx)("div",{className:"photo-marker-info-window",children:Object(S.jsx)("a",{href:e.icon.url,target:"_blank",rel:"noopener noreferrer",children:Object(S.jsx)("img",{src:e.icon.url,alt:"Photos"})})})};function We(e){var n=Object(r.useState)(!1),t=Object(Ne.a)(n,2),a=t[0],o=t[1];return Object(S.jsx)(Te.Marker,Object(q.a)(Object(q.a)({},e),{},{onClick:function(){return o(!0)},children:a&&Object(S.jsx)(Te.InfoWindow,{onCloseClick:function(){return o(!1)},children:Object(S.jsx)(Ue,Object(q.a)({},e))})}))}var Ze=function(e,n){if(0!==n.length){var t=new window.google.maps.LatLngBounds;n.forEach((function(e){!1!==e.visible&&e.files.forEach((function(e){t.extend({lat:e.imageMediaMetadata.location.latitude,lng:e.imageMediaMetadata.location.longitude})}))})),e.fitBounds(t)}},ze=function(e){var n={anchor:{x:0,y:0},labelOrigin:{x:0,y:0},scaledSize:{height:64,width:64},url:e.thumbnailLink};return{position:{lat:e.imageMediaMetadata.location.latitude,lng:e.imageMediaMetadata.location.longitude},icon:n}},_e={lat:39.873806,lng:116.22555},qe={lat:39.872542,lng:116.219536},Je=M()("photo-map:src/Application/Map/GoogleMap/ReactGoogleMaps/index.jsx"),He=Be(De),Ye=function(e){Object(l.a)(t,e);var n=Object(u.a)(t);function t(){var e;Object(s.a)(this,t);for(var r=arguments.length,a=new Array(r),o=0;o<r;o++)a[o]=arguments[o];return(e=n.call.apply(n,[this].concat(a))).handleMapMounted=function(n){Je("handleMapMounted()",n),e.map=n,Ze(n,e.props.folders)},e.handleMapUnmounted=function(){Je("handleMapUnmounted()")},e.fitMarkersSubscriber=function(n){Je("fitMarkersSubscriber()",n),e.map?Ze(e.map,e.props.folders):console.error("this.map of Google Map is undefined!")},e.addSubscribers=function(){e.fitMarkersToken=p.a.subscribe(F,e.fitMarkersSubscriber)},e.removeSubscribers=function(){p.a.unsubscribe(e.fitMarkersToken)},e.renderPhotoMarkers=function(){var n=[];return e.props.folders.forEach((function(e){!1!==e.visible&&e.files.forEach((function(e){var t=ze(e);n.push(Object(S.jsx)(We,{data:t},JSON.stringify(e)))}))})),n},e}return Object(c.a)(t,[{key:"componentDidMount",value:function(){this.addSubscribers()}},{key:"componentWillUnmount",value:function(){this.removeSubscribers()}},{key:"render",value:function(){Je("render()",this.props);var e=this.props,n=e.defaultZoom,t=e.defaultCenter,r=e.markers;return Object(S.jsxs)(He,{ref:this.mapRef,defaultZoom:n,defaultCenter:t,onMapMounted:this.handleMapMounted,onMapUnmounted:this.handleMapUnmounted,children:[r.map((function(e,n){var t=Object.assign({},e);return Object(S.jsx)(Te.Marker,Object(q.a)({},t),n)})),Object(S.jsx)(Te.Marker,{label:"Map",position:_e}),Object(S.jsx)(Te.Marker,{label:"Satelite",position:qe}),this.renderPhotoMarkers()]})}}]),t}(r.Component),Ke=t(274),Qe=t(268),$e=t.n(Qe),Xe=M()("photo-map:src/Application/Map/GoogleMap/GoogleMapReact/index.jsx"),en=function(e){Object(l.a)(t,e);var n=Object(u.a)(t);function t(){var e;Object(s.a)(this,t);for(var r=arguments.length,a=new Array(r),o=0;o<r;o++)a[o]=arguments[o];return(e=n.call.apply(n,[this].concat(a))).handleApiLoaded=function(n){var t=n.map,r=n.maps;Xe("handleApiLoaded()",t,r),e.map=t,e.maps=r,Ze(t,e.props.folders),e.renderPhotoMarkers(),e.renderOffsetMarkers()},e.fitMarkersSubscriber=function(n){Xe("fitMarkersSubscriber()",n),e.map?Ze(e.map,e.props.folders):console.error("this.map of Google Map is undefined!")},e.addSubscribers=function(){e.fitMarkersToken=p.a.subscribe(F,e.fitMarkersSubscriber)},e.removeSubscribers=function(){p.a.unsubscribe(e.fitMarkersToken)},e.renderPhotoMarkers=function(){if(Xe("renderPhotoMarkers()"),e.map){var n=[];e.props.folders.forEach((function(t){!1!==t.visible&&t.files.forEach((function(t){var r=ze(t),a=new e.maps.Marker(Object(q.a)(Object(q.a)({},r),{},{map:e.map})),o=$e.a.renderToStaticMarkup(Ue(r)),i=new e.maps.InfoWindow({content:o});a.addListener("click",(function(){i.open({anchor:a,map:e.map,shouldFocus:!1})})),n.push(a)}))}))}else g.b.error("map not mounted!")},e.renderOffsetMarkers=function(){new e.maps.Marker({position:_e,map:e.map,label:"Map"}),new e.maps.Marker({position:qe,map:e.map,label:"Satelite"})},e}return Object(c.a)(t,[{key:"componentDidMount",value:function(){this.addSubscribers()}},{key:"componentWillUnmount",value:function(){this.removeSubscribers()}},{key:"render",value:function(){return Xe("render()",this.props),Object(S.jsx)("div",{style:{height:"100vh",width:"100%"},children:Object(S.jsx)(Ke.a,{bootstrapURLKeys:{key:"AIzaSyBI9zDejJ09aIP8kw3GvTOBbYWwcOl0DUY"},defaultCenter:this.props.defaultCenter,defaultZoom:this.props.defaultZoom,yesIWantToUseGoogleMapApiInternals:!0,onGoogleApiLoaded:this.handleApiLoaded})})}}]),t}(a.a.Component),nn=function(e){Object(l.a)(t,e);var n=Object(u.a)(t);function t(){var e;Object(s.a)(this,t);for(var r=arguments.length,a=new Array(r),o=0;o<r;o++)a[o]=arguments[o];return(e=n.call.apply(n,[this].concat(a))).googleMapReactEnabled=!0,e}return Object(c.a)(t,[{key:"render",value:function(){return this.googleMapReactEnabled?Object(S.jsx)(en,{defaultZoom:this.props.defaultZoom,defaultCenter:this.props.defaultCenter,markers:this.props.markers,folders:this.props.folders}):Object(S.jsx)(Ye,{defaultZoom:this.props.defaultZoom,defaultCenter:this.props.defaultCenter,markers:this.props.markers,folders:this.props.folders})}}]),t}(a.a.Component),tn=t(159),rn=t(188),an=t.n(rn),on=t(5),sn=t.n(on),cn=sn.a.shape({latitude:sn.a.number.isRequired,longitude:sn.a.number.isRequired,altitude:sn.a.number.isRequired}),ln=sn.a.shape({location:cn}),un=sn.a.shape({webContentLink:sn.a.string,webViewLink:sn.a.string,thumbnailLink:sn.a.string,imageMediaMetadata:ln}),dn=(sn.a.shape({folderId:sn.a.string.isRequired,files:sn.a.arrayOf(un).isRequired,visible:sn.a.bool,folderName:sn.a.string}),function(e){Object(l.a)(t,e);var n=Object(u.a)(t);function t(){var e;Object(s.a)(this,t);for(var r=arguments.length,a=new Array(r),o=0;o<r;o++)a[o]=arguments[o];return(e=n.call.apply(n,[this].concat(a))).map=null,e.handleMapComponentMountOrUmount=function(n){if(null===n)return console.log("baidu map component unmounts"),void(e.map=null);e.map=n.map},e.renderPhotoMarkers=function(){var n=[];return e.props.folders.forEach((function(t,r){!1!==t.visible&&t.files.forEach((function(t,a){var o=t.imageMediaMetadata.location,i=e.props.gpsBMapPointsMapping["".concat(o.latitude,",").concat(o.longitude)];if(i){var s=new window.BMapGL.Icon(t.thumbnailLink,new window.BMapGL.Size(64,64),{});n.push(Object(S.jsx)(tn.Marker,{position:i,icon:s},"folder-".concat(r,"-file-").concat(a)))}}))})),n},e}return Object(c.a)(t,[{key:"render",value:function(){return window.BMapGL?(function(e,n){if(e)if(0!==n.length){var t=se(n);e.setViewport(t),console.log("fit baidu map to ".concat(t.length," markers"))}else console.log("no folders found, will not fitBMapMarkers for baidu map");else console.log("baidu map not loaded!")}(this.map,this.props.folders),Object(S.jsxs)(tn.Map,{ref:this.handleMapComponentMounted,style:{height:"100vh",width:"100%"},center:this.props.defaultCenter,zoom:this.props.defaultZoom,children:[Object(S.jsx)(tn.NavigationControl,{}),Object(S.jsx)(an.a,{}),this.renderPhotoMarkers()]})):null}}]),t}(a.a.Component)),pn=M()("photo-map:src/Application/Map/index.jsx"),fn={latitude:39.871446,longitude:116.215768},bn={lat:39.871446,lng:116.215768},hn={lng:116.215768,lat:39.871446},mn="map.switchmap",gn=function(e){Object(l.a)(t,e);var n=Object(u.a)(t);function t(e){var r;return Object(s.a)(this,t),(r=n.call(this,e)).handleMapChange=function(e){r.setMap(e)},r.handleRenderFinish=function(){r.setState({message:""})},r.handleLoginSuccess=function(){var e=Object(m.a)(h.a.mark((function e(n){var t,a,o;return h.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return pn("handleLoginSuccess",n),f.a.event({category:"Auth",action:"User login"}),r.setState({message:"Login successfully, try to load photos in Google Drive..."}),e.next=5,_();case 5:return t=e.sent,r.setState({message:""}),r.setState((function(e){var n=!1,r=e.folders.map((function(e){return e.folderId===X&&(n=!0,e.files=t),e}));return n||r.push({folderId:X,files:t}),{folders:r}})),e.next=10,de();case 10:if(a=e.sent,r.setState((function(e){return{folders:[].concat(Object(J.a)(e.folders),Object(J.a)(a))}})),a.forEach((function(e){p.a.publish(ne,e)})),!window.BMapGL){e.next=18;break}return e.next=16,fe(r.state.folders);case 16:o=e.sent,r.setState({gpsBMapPointsMapping:o});case 18:if("amap"!==r.state.selectedMap){e.next=21;break}return e.next=21,pe(t);case 21:p.a.publish(F);case 22:case"end":return e.stop()}}),e)})));return function(n){return e.apply(this,arguments)}}(),r.handleAMapInstanceCreated=function(e){pn("handleAMapInstanceCreated()",window.AMap),r.setState({amapLoaded:!0})},r.handleSignedOut=function(){f.a.event({category:"Auth",action:"User logout"}),r.setState({folders:[]}),p.a.publish(D)},r.handleDrawerOpen=function(){p.a.publish(Ae)},r.addSubscribers=function(){r.switchMapToken=p.a.subscribe(mn,r.switchMapSubscriber),r.showMarkersToken=p.a.subscribe("amap.showmarkers",r.showMarkersSubscriber),r.hideMarkersToken=p.a.subscribe("amap.hidemarkers",r.hideMarkersSubscriber)},r.removeSubscribers=function(){p.a.unsubscribe(r.switchMapToken)},r.switchMapSubscriber=function(){r.setMap(r.state.selectedMap===Q?K:Q)},r.showMarkersSubscriber=function(e,n){r.updateMarkersInFolderVisible(n.folderId,!0)},r.hideMarkersSubscriber=function(e,n){r.updateMarkersInFolderVisible(n.folderId,!1)},r.updateMarkersInFolderVisible=function(e,n){var t=r.state.folders.map((function(t){return t.folderId===e&&(t.visible=n),t}));r.setState({folder:t})},r.setMap=function(e){r.setState({selectedMap:e}),localStorage.setItem(I,e)},r.renderMap=function(){var e=r.state,n=e.selectedMap,t=e.folders;return n===Q?Object(S.jsx)(E,{defaultCenter:fn,defaultZoom:16,onMapInstanceCreated:r.handleAMapInstanceCreated}):n===K?Object(S.jsx)(nn,{defaultZoom:16,defaultCenter:bn,markers:[],folders:t}):null},r.renderMap2=function(){var e=r.state,n=e.selectedMap,t=e.folders;return Object(S.jsxs)("div",{className:"selected-map-".concat(n),children:[Object(S.jsx)("div",{className:"photo-map-google-map ".concat(n===K?"show":"hide"),children:Object(S.jsx)(nn,{defaultZoom:16,defaultCenter:bn,markers:[],folders:t})}),Object(S.jsx)("div",{className:"photo-map-a-map ".concat(n===Q?"show":"hide"),children:Object(S.jsx)(E,{defaultCenter:fn,defaultZoom:16,onMapInstanceCreated:r.handleAMapInstanceCreated})}),Object(S.jsx)("div",{className:"photo-map-baidu-map ".concat(n===$?"show":"hide"),children:Object(S.jsx)(dn,{defaultCenter:hn,defaultZoom:16,folders:t,gpsBMapPointsMapping:r.state.gpsBMapPointsMapping})})]})},r.state={folders:[],gpsBMapPointsMapping:{},amapLoaded:!1,message:"Rendering Google login button on left side panel..."},r.state.selectedMap=localStorage.getItem(I)||"amap",r}return Object(c.a)(t,[{key:"componentDidMount",value:function(){this.addSubscribers()}},{key:"componentWillUnmount",value:function(){this.removeSubscribers()}},{key:"render",value:function(){var e=this.state,n=e.selectedMap,t=e.message;return Object(S.jsxs)("div",{className:"map-wrapper",children:[Object(S.jsx)(Ge,{message:t}),this.renderMap2(),Object(S.jsx)("div",{className:"menu-btn-wrapper",children:Object(S.jsx)(k.a,{onClick:this.handleDrawerOpen,children:"Menu"})}),Object(S.jsx)(Pe,{selectedMap:n,folders:this.state.folders,onRenderFinish:this.handleRenderFinish,onLoginSuccess:this.handleLoginSuccess,onSignedOut:this.handleSignedOut,onMapChange:this.handleMapChange})]})}}]),t}(r.Component),jn=function(){f.a.initialize("UA-48270916-5",{})},vn=function(){document.addEventListener("keyup",(function(e){switch(e.code){case"KeyM":p.a.publish(Le);break;case"KeyS":p.a.publish(mn)}}),!1)},kn=function(){return new Promise((function(e,n){window.gapi.load("client",(function(){e()}))}))};function wn(){return Object(S.jsxs)("div",{className:"website-warning",children:[Object(S.jsx)("p",{children:"Google API not loaded!"}),Object(S.jsx)("p",{children:"Maybe you need to turn off the Adblock Plus for this website."}),Object(S.jsxs)("p",{children:["If you still have problem, please"," ",Object(S.jsx)("a",{target:"_blank",rel:"noopener noreferrer",href:"https://github.com/photo-map/photo-map.github.io/issues",children:"raise an issue"})," ","in the GitHub project."]})]})}t(523),t(524);var Mn=function(e){Object(l.a)(t,e);var n=Object(u.a)(t);function t(){var e;Object(s.a)(this,t);for(var r=arguments.length,a=new Array(r),o=0;o<r;o++)a[o]=arguments[o];return(e=n.call.apply(n,[this].concat(a))).state={gapiLoaded:!1,gapiClientLoading:!1},e.initApplication=function(){jn(),window.gapiLoadedFlag&&(e.setState({gapiLoaded:!0}),e.loadGapiClient()),vn()},e.loadGapiClient=function(){e.setState({gapiClientLoading:!0}),kn().then((function(){e.setState({gapiClientLoading:!1})}))},e}return Object(c.a)(t,[{key:"componentDidMount",value:function(){this.initApplication()}},{key:"render",value:function(){return this.state.gapiLoaded?this.state.gapiClientLoading?Object(S.jsx)("div",{children:"gapi client lib is loading"}):Object(S.jsx)("div",{className:"application photo-map",children:Object(S.jsx)(gn,{})}):Object(S.jsx)(wn,{})}}]),t}(r.Component);Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));i.a.render(Object(S.jsx)(Mn,{}),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then((function(e){e.unregister()})).catch((function(e){console.error(e.message)}))}},[[525,1,2]]]);
//# sourceMappingURL=main.221bb52e.chunk.js.map